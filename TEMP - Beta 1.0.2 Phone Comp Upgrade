<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Liquid Glass Notes ‚Äî Phone Comp</title>
<style>
    /* --- 1. CORE VARIABLES & RESET --- */
    :root {
        --glass-bg: rgba(255, 255, 255, 0.85);
        --glass-border: rgba(255, 255, 255, 0.5);
        --glass-blur: blur(16px);
        --accent-color: #447ACB;
        --bg-gradient: radial-gradient(circle at 10% 20%, rgba(69, 123, 205, 0.12) 0%, transparent 40%),
                       radial-gradient(circle at 90% 80%, rgba(156, 39, 176, 0.08) 0%, transparent 40%);
        --text-main: #1d1d1f;
        --text-light: #86868b;
        --radius-lg: 18px;
        --radius-md: 12px;
        --radius-sm: 8px;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --glass-bg: rgba(40, 40, 40, 0.85);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #f5f5f7;
            --text-light: #a1a1a6;
            --bg-color: #000000;
        }
        body { background-color: #000; }
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    html, body { height: 100%; }

    body {
        margin: 0; padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
        background: #F2F2F7;
        background-image: var(--bg-gradient);
        background-attachment: fixed;
        color: var(--text-main);
        height: 100vh;
        overflow: hidden;
    }

    /* --- GLASS UI --- */
    .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.04);
    }

    .btn {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        color: var(--text-main);
        padding: 10px 12px;
        border-radius: var(--radius-md);
        font-weight: 600;
        cursor: pointer;
    }
    .btn-primary { background: var(--accent-color); color: white; border: none; }

    /* --- LAYOUT --- */
    #app-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        padding-bottom: 90px; /* space for bottom nav */
    }

    .view-page {
        flex: 1;
        display: none;
        flex-direction: column;
        overflow: hidden;
        padding: 18px;
    }
    .view-page.active { display: flex; }

    /* --- HOME & NOTE (unchanged mostly) --- */
    .metadata-bar {
        display: flex; justify-content: space-between; padding: 12px;
        border-radius: var(--radius-md); margin-bottom: 14px;
        font-size: 13px; color: var(--text-light);
    }
    .note-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
    }
    .note-card {
        padding: 12px; height: 140px; border-radius: var(--radius-lg);
        display: flex; flex-direction: column; justify-content: space-between;
    }

    /* --- DRAW (PHONE-FRIENDLY) --- */
    #draw-view { padding: 0; display:flex; flex-direction:column; gap:0; height:100%; }
    /* top tool row (icons horizontally scrollable) */
    .top-tools {
        display:flex;
        gap:8px;
        align-items:center;
        padding:8px 10px;
        overflow-x:auto;
        -webkit-overflow-scrolling: touch;
        border-bottom: 1px solid var(--glass-border);
        background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.35));
    }
    .top-tools .tool {
        flex: 0 0 auto;
        display:flex;
        align-items:center;
        gap:8px;
        padding:8px 10px;
        border-radius: 12px;
        background: transparent;
        font-size: 18px;
        cursor:pointer;
        color: var(--text-main);
    }
    .top-tools .tool.active { background: var(--accent-color); color: white; box-shadow: 0 6px 18px rgba(68,122,203,0.24); }

    /* big canvas area */
    .draw-body {
        display:flex;
        flex-direction:column;
        flex:1;
        min-height:0; /* important for flex children overflow on mobile */
        background: white;
        position:relative;
    }

    .canvas-area { flex:1; position:relative; background: white; cursor: crosshair; touch-action: none; display:flex; }
    #canvas-container { flex:1; display:flex; min-height:0; }
    canvas { width:100%; height:100%; display:block; }

    /* bottom layers bar */
    .layers-bottom {
        display:flex;
        gap:10px;
        align-items:center;
        padding:8px 10px;
        border-top: 1px solid var(--glass-border);
        overflow-x:auto;
        background: linear-gradient(0deg, rgba(255,255,255,0.6), rgba(255,255,255,0.35));
    }
    .layer-pill {
        flex:0 0 auto;
        display:flex;
        align-items:center;
        gap:8px;
        padding:8px 10px;
        border-radius: 14px;
        background: rgba(0,0,0,0.04);
        font-size:13px;
    }

    /* desktop fallback: keep side tools if large screen */
    @media (min-width: 900px) {
        #draw-view { padding: 0 12px; }
        .top-tools { display:none; } /* keep existing left tool-strip for desktops in original file, we hide the mobile one */
    }

    /* --- NAV --- */
    .nav-bar {
        position: fixed; bottom: 25px; left: 20px; right: 20px;
        height: 70px; border-radius: 35px;
        display: flex; justify-content: space-around; align-items: center;
        z-index: 100;
    }
    .nav-item {
        display: flex; flex-direction: column; align-items: center; gap: 4px;
        border: none; background: none; color: var(--text-light); font-size: 10px;
    }
    .nav-item svg { width: 24px; height: 24px; fill: currentColor; }
    .nav-item.active { color: var(--accent-color); }

    /* Utility */
    .hidden { display: none !important; }
    input[type="color"] { width: 36px; height: 36px; border: none; border-radius: 50%; padding: 0; overflow: hidden; }

    /* small-screen polish */
    @media (max-width: 420px) {
        .note-grid { grid-template-columns: 1fr; }
        .top-tools .tool { padding:8px; font-size:16px; border-radius:10px; }
        .layers-bottom { padding:8px; gap:8px; }
        .nav-bar { left: 12px; right: 12px; bottom: 14px; height: 64px; }
    }
</style>
</head>
<body>

<div id="app-container">

    <div id="home-view" class="view-page active">
        <div class="glass-panel metadata-bar">
            <span>Subject</span> <span>|</span> <span>Keywords</span> <span>|</span> <span>Source</span>
        </div>

        <button class="btn btn-primary" onclick="switchTab('note')" style="padding: 16px; font-size: 18px; margin-bottom: 16px; display:flex; align-items:center; justify-content:center; gap:10px;">
            <span>+</span> Create Note
        </button>

        <div class="note-grid">
            <div class="glass-panel note-card">
                <div><h3 style="margin:0 0 5px 0">Biology</h3><small style="color:var(--text-light)">Cell structures...</small></div>
                <small>10:00 AM</small>
            </div>
            <div class="glass-panel note-card">
                <div><h3 style="margin:0 0 5px 0">Sketch</h3><small style="color:var(--text-light)">Project ideas...</small></div>
                <small>Yesterday</small>
            </div>
        </div>
    </div>

    <div id="note-view" class="view-page">
        <div style="display:flex; gap:12px; align-items:center; margin-bottom:18px;">
            <button id="save-note-btn" class="btn btn-primary">Save Note</button>
            <div id="autosave-indicator" style="color:var(--text-light); font-size:13px;">Autosave: on</div>
        </div>

        <input type="text" placeholder="Title" style="font-size:28px; font-weight:800; border:none; background:transparent; outline:none; margin-bottom:14px;">
        <textarea placeholder="Start typing..." style="flex:1; border:none; background:transparent; resize:none; font-size:16px; outline:none;"></textarea>
    </div>

    <div id="draw-view" class="view-page glass-panel">
        <!-- Top tools moved here (mobile-friendly horizontal toolbar) -->
        <div class="top-tools">
            <div class="tool" onclick="setTool('move')" title="Move">‚úã</div>
            <div class="tool active" onclick="setTool('pen')" title="Pen">üñäÔ∏è</div>
            <div class="tool" onclick="setTool('eraser')" title="Eraser">‚å´</div>
            <div class="tool" onclick="setTool('text')" title="Text">T</div>
            <div class="tool" onclick="setTool('rect')" title="Rectangle">‚¨ú</div>
            <div class="tool" onclick="setTool('line')" title="Line">‚ï±</div>
            <div class="tool" onclick="document.getElementById('file-input').click()" title="Add File">üìÇ</div>
            <div class="tool" onclick="setTool('fill')" title="Fill">üíß</div>
            <div style="width:10px"></div>
            <input type="color" id="color-picker" value="#000000" onchange="setColor(this.value)" style="margin-left:4px;">
            <input type="file" id="file-input" hidden>
            <div style="flex:1"></div>
            <div class="tool" onclick="undo()" title="Undo">‚§∫</div>
            <div class="tool" onclick="redo()" title="Redo">‚§ª</div>
            <div class="tool" onclick="saveDrawing()" title="Save">üíæ</div>
        </div>

        <div class="draw-body">
            <div class="canvas-area">
                <div id="canvas-container" style="flex:1; display:flex; min-height:0;">
                    <canvas id="main-canvas"></canvas>
                </div>
            </div>

            <!-- Layers moved to bottom bar -->
            <div class="layers-bottom glass-panel" style="border-radius: 10px; margin:10px;">
                <div class="layer-pill"><div style="width:14px; height:14px; border-radius:4px; background:#fff; border:1px solid #ccc;"></div> Bkgrnd</div>
                <div class="layer-pill"><div style="width:14px; height:14px; border-radius:4px; background:#fff; border:1px solid #ccc;"></div> Layer 1</div>
                <div class="layer-pill"><div style="width:14px; height:14px; border-radius:4px; background:#fff; border:1px solid #ccc;"></div> Layer 2</div>
                <div class="layer-pill"><div style="width:14px; height:14px; border-radius:4px; background:#fff; border:1px solid #ccc;"></div> Layer 3</div>
                <div style="flex:1"></div>
                <div class="layer-pill" onclick="clearCanvas()" style="background:rgba(255,0,0,0.06);">Clear</div>
            </div>
        </div>
    </div>

    <div id="camera-view" class="view-page" style="align-items:center; justify-content:center;">
        <div class="glass-panel" style="padding:40px; border-radius:30px; text-align:center;">
            <div style="font-size:60px; margin-bottom:20px;">üì∏</div>
            <button class="btn btn-primary" onclick="document.getElementById('cam-input').click()">Open Camera</button>
            <input type="file" id="cam-input" accept="image/*" capture="environment" hidden>
            <p style="margin-top:20px; color:var(--text-light); font-size:12px;">Photos are saved to your notes.</p>
        </div>
    </div>

</div>

<div class="nav-bar glass-panel">
    <button class="nav-item active" onclick="switchTab('home')">
        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        Home
    </button>
    <button class="nav-item" onclick="switchTab('note')">
        <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        Note
    </button>
    <button class="nav-item" onclick="switchTab('draw')">
        <svg viewBox="0 0 24 24"><path d="M7 22l-7 1 1-7 6 6zm1-1l11-11-6-6-11 11 6 6z"/></svg>
        Draw
    </button>
    <button class="nav-item" onclick="switchTab('camera')">
        <svg viewBox="0 0 24 24"><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm6 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
        Camera
    </button>
</div>

<script>
    // --- APP STATE & STORAGE ---
    let notes = JSON.parse(localStorage.getItem('glass_notes')) || [];
    let currentTool = 'pen';
    let currentColor = '#000000';
    let isDrawing = false;

    // Canvas + history
    const canvas = document.getElementById('main-canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-container');
    let startX, startY;
    let history = [];
    let historyIndex = -1;
    const MAX_HISTORY = 50;

    function pushHistory() {
        try {
            const data = canvas.toDataURL();
            if (historyIndex < history.length - 1) history = history.slice(0, historyIndex + 1);
            history.push(data);
            if (history.length > MAX_HISTORY) history.shift();
            historyIndex = history.length - 1;
        } catch (e) {
            console.warn("pushHistory:", e);
        }
    }

    function restoreFromDataURL(dataURL) {
        const img = new Image();
        img.onload = () => {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = dataURL;
    }

    function undo() {
        if (historyIndex > 0) {
            historyIndex--;
            restoreFromDataURL(history[historyIndex]);
        } else if (historyIndex === 0) {
            historyIndex = -1;
            ctx.clearRect(0,0,canvas.width, canvas.height);
        }
    }

    function redo() {
        if (historyIndex < history.length - 1) {
            historyIndex++;
            restoreFromDataURL(history[historyIndex]);
        }
    }

    function resizeCanvas() {
        // save current
        const prev = canvas.toDataURL();
        const w = container.offsetWidth;
        const h = container.offsetHeight;
        canvas.width = w;
        canvas.height = h;
        // redraw last state if exists
        if (historyIndex >= 0 && history[historyIndex]) {
            restoreFromDataURL(history[historyIndex]);
        } else {
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            img.src = prev;
        }
    }

    // --- NAV & RENDER ---
    function switchTab(tabId) {
        document.querySelectorAll('.view-page').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const view = document.getElementById(tabId + '-view');
        if (view) view.classList.add('active');

        const buttons = document.querySelectorAll('.nav-item');
        if(tabId === 'home') buttons[0].classList.add('active');
        if(tabId === 'note') buttons[1].classList.add('active');
        if(tabId === 'draw') { buttons[2].classList.add('active'); setTimeout(resizeCanvas, 50); }
        if(tabId === 'camera') buttons[3].classList.add('active');
        if(tabId === 'home') renderNotes();
    }

    function renderNotes() {
        const grid = document.querySelector('.note-grid');
        grid.innerHTML = '';
        notes.forEach((note, index) => {
            const card = document.createElement('div');
            card.className = 'glass-panel note-card';
            const preview = note.type === 'sketch' ? 'üé® Drawing' : (note.content || '').substring(0, 30) + (note.content && note.content.length > 30 ? '...' : '');
            card.innerHTML = `
                <div onclick="deleteNote(${index})" style="position:absolute; top:10px; right:10px; font-size:12px; opacity:0.5; cursor:pointer;">‚úï</div>
                <div onclick="openNote(${index})" style="cursor:pointer;">
                    <h3 style="margin:0 0 5px 0">${note.title || 'Untitled'}</h3>
                    <small style="color:var(--text-light)">${preview}</small>
                </div>
                <small>${note.date}</small>
            `;
            grid.appendChild(card);
        });
    }

    // --- SAVING ---
    function addNote(note) {
        notes.unshift(note);
        syncStorage();
    }

    function saveTextNote(silent = false) {
        const titleEl = document.querySelector('#note-view input');
        const bodyEl = document.querySelector('#note-view textarea');
        const title = titleEl ? titleEl.value : '';
        const content = bodyEl ? bodyEl.value : '';
        if(!title.trim() && !content.trim()) return;
        const newNote = { type: 'text', title: title || 'New Note', content, date: new Date().toLocaleDateString() };
        addNote(newNote);
        if (!silent) {
            switchTab('home');
            if (titleEl) titleEl.value = '';
            if (bodyEl) bodyEl.value = '';
        } else showSavedIndicator();
    }

    function saveDrawing() {
        const dataURL = canvas.toDataURL();
        const newSketch = { type: 'sketch', title: 'Sketch ' + (notes.length + 1), content: dataURL, date: new Date().toLocaleDateString() };
        addNote(newSketch);
        alert("Sketch Saved!");
        pushHistory();
        switchTab('home');
        clearCanvas();
    }

    function deleteNote(index) {
        if(confirm("Delete this note?")) {
            notes.splice(index, 1);
            syncStorage();
            renderNotes();
        }
    }

    function openNote(index) {
        const note = notes[index];
        if (!note) return;
        if (note.type === 'text') {
            switchTab('note');
            document.querySelector('#note-view input').value = note.title || '';
            document.querySelector('#note-view textarea').value = note.content || '';
        } else if (note.type === 'sketch') {
            switchTab('draw');
            const img = new Image();
            img.onload = () => {
                ctx.clearRect(0,0,canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                pushHistory();
            };
            img.src = note.content;
        }
    }

    function syncStorage() {
        localStorage.setItem('glass_notes', JSON.stringify(notes));
    }

    // --- DRAW ENGINE (mobile-friendly) ---
    function setTool(tool) {
        currentTool = tool;
        document.querySelectorAll('.top-tools .tool').forEach(el => el.classList.remove('active'));
        // activate corresponding tool button (first matching text/icon)
        Array.from(document.querySelectorAll('.top-tools .tool')).find(el => {
            if ((tool === 'pen' && el.textContent.includes('üñä')) ||
                (tool === 'eraser' && el.textContent.includes('‚å´')) ||
                (tool === 'move' && el.textContent.includes('‚úã'))) {
                el.classList.add('active');
                return true;
            }
            return false;
        });
    }

    function setColor(hex) { currentColor = hex; }

    function clearCanvas() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        pushHistory();
    }

    // pointer handlers (touch-friendly)
    function pointerDown(e) {
        if (currentTool !== 'pen' && currentTool !== 'eraser') return;
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        // support touch and mouse pointer events
        const clientX = e.clientX !== undefined ? e.clientX : (e.touches && e.touches[0] && e.touches[0].clientX) || 0;
        const clientY = e.clientY !== undefined ? e.clientY : (e.touches && e.touches[0] && e.touches[0].clientY) || 0;
        startX = (clientX - rect.left) * (canvas.width / rect.width);
        startY = (clientY - rect.top) * (canvas.height / rect.height);

        ctx.beginPath();
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.lineWidth = currentTool === 'eraser' ? 28 : 4;
        ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : currentColor;
        ctx.moveTo(startX, startY);
        e.preventDefault();
    }

    function pointerMove(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX !== undefined ? e.clientX : (e.touches && e.touches[0] && e.touches[0].clientX) || 0;
        const clientY = e.clientY !== undefined ? e.clientY : (e.touches && e.touches[0] && e.touches[0].clientY) || 0;
        const x = (clientX - rect.left) * (canvas.width / rect.width);
        const y = (clientY - rect.top) * (canvas.height / rect.height);
        ctx.lineTo(x, y);
        ctx.stroke();
    }

    function pointerUp(e) {
        if (!isDrawing) return;
        isDrawing = false;
        ctx.closePath();
        pushHistory();
    }

    // attach pointer events
    // Use pointer events where available; fallback to touch/mouse
    const supportsPointer = window.PointerEvent !== undefined;
    if (supportsPointer) {
        canvas.addEventListener('pointerdown', pointerDown);
        canvas.addEventListener('pointermove', pointerMove);
        canvas.addEventListener('pointerup', pointerUp);
        canvas.addEventListener('pointercancel', pointerUp);
    } else {
        canvas.addEventListener('touchstart', pointerDown);
        canvas.addEventListener('touchmove', pointerMove);
        canvas.addEventListener('touchend', pointerUp);
        canvas.addEventListener('mousedown', pointerDown);
        window.addEventListener('mousemove', pointerMove);
        window.addEventListener('mouseup', pointerUp);
    }

    // --- AUTOSAVE & SHORTCUTS ---
    let autosaveTimer = null;
    const AUTOSAVE_DELAY = 1400;
    function scheduleAutosave() {
        if (autosaveTimer) clearTimeout(autosaveTimer);
        autosaveTimer = setTimeout(() => saveTextNote(true), AUTOSAVE_DELAY);
    }
    function showSavedIndicator() {
        const indicator = document.createElement('div');
        indicator.textContent = 'Saved';
        indicator.style.position = 'fixed';
        indicator.style.bottom = '110px';
        indicator.style.right = '22px';
        indicator.style.padding = '8px 12px';
        indicator.style.background = 'rgba(0,0,0,0.75)';
        indicator.style.color = 'white';
        indicator.style.borderRadius = '8px';
        indicator.style.zIndex = 200;
        document.body.appendChild(indicator);
        setTimeout(() => indicator.remove(), 1200);
    }

    document.getElementById('save-note-btn').addEventListener('click', () => saveTextNote(false));
    const titleInput = document.querySelector('#note-view input');
    const bodyArea = document.querySelector('#note-view textarea');
    [titleInput, bodyArea].forEach(el => { if(!el) return; el.addEventListener('input', scheduleAutosave); });

    window.addEventListener('keydown', (e) => {
        const isSave = (e.key === 's' || e.key === 'S') && (e.ctrlKey || e.metaKey);
        const isUndo = (e.key === 'z' || e.key === 'Z') && (e.ctrlKey || e.metaKey) && !e.shiftKey;
        const isRedo = ((e.key === 'y' || e.key === 'Y') && (e.ctrlKey || e.metaKey)) || ((e.key === 'z' || e.key === 'Z') && (e.ctrlKey || e.metaKey) && e.shiftKey);

        if (isSave) {
            e.preventDefault();
            if (document.getElementById('note-view').classList.contains('active')) {
                saveTextNote(false);
                showSavedIndicator();
            } else if (document.getElementById('draw-view').classList.contains('active')) {
                saveDrawing();
            }
        }
        if (isUndo && document.getElementById('draw-view').classList.contains('active')) {
            e.preventDefault(); undo();
        }
        if (isRedo && document.getElementById('draw-view').classList.contains('active')) {
            e.preventDefault(); redo();
        }
    });

    // --- INIT ---
    window.addEventListener('load', () => {
        renderNotes();
        switchTab('home');
        // size canvas for mobile draw region when the draw view is active
        setTimeout(() => {
            // ensure container sizing stabilizes
            try { resizeCanvas(); } catch (e) {}
        }, 100);
        // initial history state
        pushHistory();
    });

    window.addEventListener('resize', () => {
        // if draw view active, resize
        if (document.getElementById('draw-view').classList.contains('active')) resizeCanvas();
        else {
            // keep canvas at container size for future open
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
        }
    });
</script>

</body>
</html>